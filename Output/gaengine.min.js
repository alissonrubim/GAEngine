window.GAEngine={};GAEngine.Log={};GAEngine.Log.Info=function(){GAEngine.Log.Debug&&console.log.apply(console,arguments)};GAEngine.Log.Debug=!1;
GAEngine.Generation=function(c){var b={},a=this;b.mainThread=null;b.currentIndex=0;a.Delay=0;a.Debug=0;a.FitnessTarget=0;a.MaximumIndexToGiveUp=0;a.Events={OnCalculateFitness:!1,OnGiveUp:!1,OnComplete:!1,OnStop:!1};a.Population={SubjectsSize:0,MutationProvability:0,Subject:{GenesSize:0,Events:{OnCalculateFitness:!1},Gene:{Events:{OnCreateRandomGeneValue:!1}}}};a.Constructor=function(d){a.Delay=d.Delay||a.Delay;a.Debug=d.Debug||a.Debug;a.Events=d.Events||a.Events;a.FitnessTarget=d.FitnessTarget||a.FitnessTarget;
a.MaximumIndexToGiveUp=d.MaximumIndexToGiveUp||a.MaximumIndexToGiveUp;a.Population=new GAEngine.Population({Generation:a,SubjectsSize:d.Population.SubjectsSize,MutationProvability:d.Population.MutationProvability,Subject:{GenesSize:d.Population.Subject.GenesSize,Events:{OnCalculateFitness:d.Population.Subject.Events.OnCalculateFitness},Gene:{Events:{OnCreateRandomGeneValue:d.Population.Subject.Gene.Events.OnCreateRandomGeneValue}}}});b.mainThread=new GAEngine.Thread.Thread({OnLoop:b.threadLoop,Delay:a.Delay});
GAEngine.Log.Debug=a.Debug;return a};a.Start=function(){a.Population.GenerateRandomSubjects(a.Population.SubjectsSize);b.mainThread.Start()};a.Stop=function(){GAEngine.Log.Info("The program was stoped!");b.mainThread.Stop();a.Events.OnStop(a)};a.GetCurrentIndex=function(){return b.currentIndex};b.threadLoop=function(){var d=a.Events.OnCalculateFitness(a)>=a.FitnessTarget,c=b.currentIndex==a.MaximumIndexToGiveUp;if(a.Population.Subjects.length<a.Population.SubjectsSize)throw"The population is smallest than the SubjectsSize configuration";
c||d?(GAEngine.Log.Info("Used seed: "+GAEngine.Random.Seed),b.mainThread.Stop(),c?(GAEngine.Log.Info("The program rechead the MaximumIndexToGiveUp, that is "+a.MaximumIndexToGiveUp+" generations"),a.Events.OnGiveUp(a)):(GAEngine.Log.Info("The program found the best generation, that is "+b.currentIndex+" generation"),a.Events.OnComplete(a))):(b.currentIndex++,GAEngine.Log.Info("Generation "+b.currentIndex+" started:"),GAEngine.Log.Info("    - Selecting subjects..."),a.Population.DoSelect(),GAEngine.Log.Info("    - Cross-over subjects..."),
a.Population.DoCrossOver(),GAEngine.Log.Info("    - Mutating subjects..."),a.Population.DoMutation(),GAEngine.Log.Info("    - Generation "+b.currentIndex+" successfully finished."))};return a.Constructor(c)};
GAEngine.Population=function(c){var b={},a=this;a.Generation=null;a.MutationProvability=0;a.Subjects=[];a.SubjectsSize=0;a.Subject={GenesSize:0,Events:{OnCalculateFitness:!1},Gene:{Events:{OnCreateRandomGeneValue:!1}}};a.Constructor=function(b){a.Generation=b.Generation||a.Generation;a.Subject=b.Subject||a.Subject;a.Subjects=b.Subjects||a.Subjects;a.SubjectsSize=b.SubjectsSize||a.SubjectsSize;a.MutationProvability=b.MutationProvability||a.MutationProvability;if(null==a.Generation)throw"The generation can't be null";
return a};a.GenerateRandomSubjects=function(d){a.SubjectsSize=d;GAEngine.Array.Clear(a.Subjects);for(d=0;d<a.SubjectsSize;d++){var c=b.createSubject();c.GenerateRandomGenes(a.Subject.GenesSize);a.Subjects.push(c)}GAEngine.Log.Info("Population was successfully inicializated with "+a.Subjects.length+" subjects.")};a.DoSelect=function(){for(var b=[];b.length<a.Subjects.length;){var c=a.Subjects.reduce(function(a,b){return a+b.GetFitness()+1},0);c=GAEngine.Random.Get()*c+1;for(var e=0;e<a.Subjects.length;e++)if(c-=
a.Subjects[e].GetFitness(),1>c){b.push(a.Subjects[e]);break}}a.Subjects=b};a.DoCrossOver=function(){var d=GAEngine.Array.Clone(a.Subjects),c=GAEngine.Array.Shuffle(a.Subjects),e=a.Subjects.length;GAEngine.Array.Clear(a.Subjects);for(var f=0;f<e;f++){var m=function(a,b,d){var c=a.Fitness+d[f].Genes[b].Fitness;parseInt(GAEngine.Random.Get()*c)<a.Fitness?k.Genes[b]=a:k.Genes[b]=d[f].Genes[b]},l=parseInt(GAEngine.Random.Get()*a.Subject.GenesSize),k=b.createSubject(),g=[],h=[];0==parseInt(2*GAEngine.Random.Get())?
(g=d,h=c):(g=c,h=d);var n=g[f].Genes.slice(0,l),p=[].concat(h[f].Genes.slice(l));n.forEach(function(a,b){m(a,b,h)});p.forEach(function(a,b){m(a,b+l,g)});a.Subjects.push(k)}};a.DoMutation=function(){if(0<a.MutationProvability)for(var b=0;b<a.Subjects.length;b++)if(parseInt(100*GAEngine.Random.Get())<=a.MutationProvability)for(var c=parseInt(GAEngine.Random.Get()*a.Subject.GenesSize),e=0;e<c;e++)a.Subjects[b].CreateGene(parseInt(GAEngine.Random.Get()*a.Subject.GenesSize))};b.createSubject=function(){return new GAEngine.Subject({Population:a,
GenesSize:a.Subject.GenesSize,Events:{OnCalculateFitness:a.Subject.Events.OnCalculateFitness},Gene:{Events:{OnCreateRandomGeneValue:a.Subject.Gene.Events.OnCreateRandomGeneValue}}})};return a.Constructor(c)};
GAEngine.Subject=function(c){var b=this;b.Genes=[];b.Population=null;b.GenesSize=0;b.Events={OnCalculateFitness:!1};b.Gene={Events:{OnCreateRandomGeneValue:!1}};var a=null;b.Constructor=function(a){b.Genes=a.Genes||b.Genes;b.Population=a.Population||b.Population;b.GenesSize=a.GenesSize||b.GenesSize;b.Events=a.Events||b.Events;b.Gene=a.Gene||b.Gene;if(null==b.Population)throw"The population can't be null";return b};b.GenerateRandomGenes=function(a){b.GenesSize=a;GAEngine.Array.Clear(b.Genes);for(a=
0;a<b.GenesSize;a++)b.CreateGene(a)};b.GetFitness=function(){null==a&&(a=b.Events.OnCalculateFitness(b));if(isNaN(a))throw"The Fitness is not a valid number";if(0>a)throw"The Fitness can't be a negative number!";return a};b.CreateGene=function(a){var c=new GAEngine.Gene({Subject:b,Index:a,Events:{OnCreateRandomGeneValue:b.Gene.Events.OnCreateRandomGeneValue}});c.CreateRandomValue();return b.Genes[a]=c};return b.Constructor(c)};
GAEngine.Gene=function(c){var b=this;b.Value=null;b.Fitness=0;b.Index=0;b.Subject=null;b.Events={OnCreateRandomGeneValue:!1};b.Constructor=function(a){b.Value=a.Value||b.Value;b.Fitness=a.Fitness||b.Fitness;b.Index=a.Index||b.Index;b.Events=a.Events||b.Events;b.Subject=a.Subject||b.Subject;return b};b.CreateRandomValue=function(){b.Value=b.Events.OnCreateRandomGeneValue(b);return b.Value};return b.Constructor(c)};GAEngine.Random={};
GAEngine.Random.SetSeed=function(c){GAEngine.Random.Seed=c;GAEngine.Random._seedindex=GAEngine.Random.Seed};GAEngine.Random.Get=function(){if(void 0==GAEngine.Random._seedindex)throw"Use GAEngine.Random.SetSeed to set a seed for the randomyc system";GAEngine.Random._seedindex=(9301*GAEngine.Random._seedindex+49297)%233280;return GAEngine.Random._seedindex/233280};GAEngine.Random.GetBetween=function(c,b){return parseInt(GAEngine.Random.Get()*b)+c};GAEngine.Thread={};
GAEngine.Thread.Thread=function(c){var b,a=this;a.OnLoop=null;a.Params=null;a.Delay=0;var d=b=!1;a.Constructor=function(b){a.OnLoop=b.OnLoop;a.Params=b.Params;a.Delay=b.Delay||a.Delay;return a};a.Start=function(){b=!0;d=!1;var c=function(){b&&(d?setTimeout(c,1):(a.OnLoop(),setTimeout(c,a.Delay)))};setTimeout(c,0)};a.Stop=function(){b=!1};a.Pause=function(){d=!0};a.Continue=function(){d=!1};return a.Constructor(c)};GAEngine.Array={};GAEngine.Array.Clone=function(c){return c.slice(0)};
GAEngine.Array.Clear=function(c){return c.splice(0)};GAEngine.Array.Shuffle=function(c){c=GAEngine.Array.Clone(c);for(var b=c.length-1;0<b;b--){var a=Math.floor(GAEngine.Random.Get()*(b+1)),d=c[b];c[b]=c[a];c[a]=d}return c};