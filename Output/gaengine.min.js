window.GAEngine={},GAEngine.Log={},GAEngine.Log.Info=function(){GAEngine.Log.Debug&&console.log.apply(console,arguments)},GAEngine.Log.Debug=!1,GAEngine.Generation=function(a){var b={},c=this;return b.mainThread=null,b.currentIndex=0,c.Delay=0,c.Debug=0,c.FitnessTarget=0,c.MaximumIndexToGiveUp=0,c.Events={OnCalculateFitness:!1,OnGiveUp:!1,OnComplete:!1,OnStop:!1},c.Population={SubjectsSize:0,MutationProvability:0,Subject:{GenesSize:0,Events:{OnCalculateFitness:!1},Gene:{Events:{OnCreateRandomGeneValue:!1}}}},c.Constructor=function(a){return c.Delay=a.Delay||c.Delay,c.Debug=a.Debug||c.Debug,c.Events=a.Events||c.Events,c.FitnessTarget=a.FitnessTarget||c.FitnessTarget,c.MaximumIndexToGiveUp=a.MaximumIndexToGiveUp||c.MaximumIndexToGiveUp,c.Population=new GAEngine.Population({Generation:c,SubjectsSize:a.Population.SubjectsSize,MutationProvability:a.Population.MutationProvability,Subject:{GenesSize:a.Population.Subject.GenesSize,Events:{OnCalculateFitness:a.Population.Subject.Events.OnCalculateFitness},Gene:{Events:{OnCreateRandomGeneValue:a.Population.Subject.Gene.Events.OnCreateRandomGeneValue}}}}),b.mainThread=new GAEngine.Thread.Thread({OnLoop:b.threadLoop,Delay:c.Delay}),GAEngine.Log.Debug=c.Debug,c},c.Start=function(){c.Population.GenerateRandomSubjects(c.Population.SubjectsSize),b.mainThread.Start()},c.Stop=function(){GAEngine.Log.Info("The program was stoped!"),b.mainThread.Stop(),c.Events.OnStop(c)},c.GetCurrentIndex=function(){return b.currentIndex},b.threadLoop=function(){var a=c.Events.OnCalculateFitness(c)>=c.FitnessTarget,d=b.currentIndex==c.MaximumIndexToGiveUp;if(c.Population.Subjects.length<c.Population.SubjectsSize)throw"The population is smallest than the SubjectsSize configuration";d||a?(GAEngine.Log.Info("Used seed: "+GAEngine.Random.Seed),b.mainThread.Stop(),d?(GAEngine.Log.Info("The program rechead the MaximumIndexToGiveUp, that is "+c.MaximumIndexToGiveUp+" generations"),c.Events.OnGiveUp(c)):(GAEngine.Log.Info("The program found the best generation, that is "+b.currentIndex+" generation"),c.Events.OnComplete(c))):(b.currentIndex++,GAEngine.Log.Info("Generation "+b.currentIndex+" started:"),GAEngine.Log.Info("    - Selecting subjects..."),c.Population.DoSelect(),GAEngine.Log.Info("    - Cross-over subjects..."),c.Population.DoCrossOver(),GAEngine.Log.Info("    - Mutating subjects..."),c.Population.DoMutation(),GAEngine.Log.Info("    - Generation "+b.currentIndex+" successfully finished."))},c.Constructor(a)},GAEngine.Population=function(a){var b={},c=this;return c.Generation=null,c.MutationProvability=0,c.Subjects=[],c.SubjectsSize=0,c.Subject={GenesSize:0,Events:{OnCalculateFitness:!1},Gene:{Events:{OnCreateRandomGeneValue:!1}}},c.Constructor=function(a){if(c.Generation=a.Generation||c.Generation,c.Subject=a.Subject||c.Subject,c.Subjects=a.Subjects||c.Subjects,c.SubjectsSize=a.SubjectsSize||c.SubjectsSize,c.MutationProvability=a.MutationProvability||c.MutationProvability,null==c.Generation)throw"The generation can't be null";return c},c.GenerateRandomSubjects=function(a){c.SubjectsSize=a,GAEngine.Array.Clear(c.Subjects);for(var d,e=0;e<c.SubjectsSize;e++)d=b.createSubject(),d.GenerateRandomGenes(c.Subject.GenesSize),c.Subjects.push(d);GAEngine.Log.Info("Population was successfully inicializated with "+c.Subjects.length+" subjects.")},c.DoSelect=function(){for(var a=[];a.length<c.Subjects.length;)for(var b=c.Subjects.reduce((c,a)=>c+a.GetFitness()+1,0),d=GAEngine.Random.Get()*b+1,e=0;e<c.Subjects.length;e++)if(d-=c.Subjects[e].GetFitness(),1>d){a.push(c.Subjects[e]);break}c.Subjects=a},c.DoCrossOver=function(){var a=GAEngine.Array.Clone(c.Subjects),d=GAEngine.Array.Shuffle(c.Subjects),e=c.Subjects.length;GAEngine.Array.Clear(c.Subjects);for(var f=0;f<e;f++){function e(a,b,c){var d=a.Fitness+c[f].Genes[b].Fitness,e=parseInt(GAEngine.Random.Get()*d);h.Genes[b]=e<a.Fitness?a:c[f].Genes[b]}var g=parseInt(GAEngine.Random.Get()*c.Subject.GenesSize),h=b.createSubject(),i=[],j=[];0==parseInt(2*GAEngine.Random.Get())?(i=a,j=d):(i=d,j=a);var k=i[f].Genes.slice(0,g),l=[].concat(j[f].Genes.slice(g));k.forEach(function(c,a){e(c,a,j)}),l.forEach(function(c,a){e(c,a+g,i)}),c.Subjects.push(h)}},c.DoMutation=function(){if(0<c.MutationProvability)for(var a,b=0;b<c.Subjects.length;b++)if(a=parseInt(100*GAEngine.Random.Get()),a<=c.MutationProvability)for(var d=parseInt(GAEngine.Random.Get()*c.Subject.GenesSize),e=0;e<d;e++)c.Subjects[b].CreateGene(parseInt(GAEngine.Random.Get()*c.Subject.GenesSize))},b.createSubject=function(){return new GAEngine.Subject({Population:c,GenesSize:c.Subject.GenesSize,Events:{OnCalculateFitness:c.Subject.Events.OnCalculateFitness},Gene:{Events:{OnCreateRandomGeneValue:c.Subject.Gene.Events.OnCreateRandomGeneValue}}})},c.Constructor(a)},GAEngine.Subject=function(a){var b={},c=this;return c.Genes=[],c.Population=null,c.GenesSize=0,c.Events={OnCalculateFitness:!1},c.Gene={Events:{OnCreateRandomGeneValue:!1}},b.fitness=null,c.Constructor=function(a){if(c.Genes=a.Genes||c.Genes,c.Population=a.Population||c.Population,c.GenesSize=a.GenesSize||c.GenesSize,c.Events=a.Events||c.Events,c.Gene=a.Gene||c.Gene,null==c.Population)throw"The population can't be null";return c},c.GenerateRandomGenes=function(a){c.GenesSize=a,GAEngine.Array.Clear(c.Genes);for(var b=0;b<c.GenesSize;b++)c.CreateGene(b)},c.GetFitness=function(){if(null==b.fitness&&(b.fitness=c.Events.OnCalculateFitness(c)),isNaN(b.fitness))throw"The Fitness is not a valid number";if(0>b.fitness)throw"The Fitness can't be a negative number!";return b.fitness},c.CreateGene=function(a){var b=new GAEngine.Gene({Subject:c,Index:a,Events:{OnCreateRandomGeneValue:c.Gene.Events.OnCreateRandomGeneValue}});return b.CreateRandomValue(),c.Genes[a]=b,b},c.Constructor(a)},GAEngine.Gene=function(a){var b=this;return b.Value=null,b.Fitness=0,b.Index=0,b.Subject=null,b.Events={OnCreateRandomGeneValue:!1},b.Constructor=function(a){return b.Value=a.Value||b.Value,b.Fitness=a.Fitness||b.Fitness,b.Index=a.Index||b.Index,b.Events=a.Events||b.Events,b.Subject=a.Subject||b.Subject,b},b.CreateRandomValue=function(){return b.Value=b.Events.OnCreateRandomGeneValue(b),b.Value},b.Constructor(a)},GAEngine.Random={},GAEngine.Random.SetSeed=function(a){GAEngine.Random.Seed=a,GAEngine.Random._seedindex=GAEngine.Random.Seed},GAEngine.Random.Get=function(){if(void 0==GAEngine.Random._seedindex)throw"Use GAEngine.Random.SetSeed to set a seed for the randomyc system";return GAEngine.Random._seedindex=(9301*GAEngine.Random._seedindex+49297)%233280,GAEngine.Random._seedindex/233280},GAEngine.Random.GetBetween=function(a,b){return parseInt(GAEngine.Random.Get()*b)+a},GAEngine.Thread={},GAEngine.Thread.Thread=function(a){var b={},c=this;return c.OnLoop=null,c.Params=null,c.Delay=0,b.isAlive=!1,b.isPaused=!1,b.interval=null,c.Constructor=function(a){return c.OnLoop=a.OnLoop,c.Params=a.Params,c.Delay=a.Delay||c.Delay,c},c.Start=function(){b.isAlive=!0,b.isPaused=!1;var a=function(){b.isAlive&&(b.isPaused?b.interval=setTimeout(a,1):(c.OnLoop(),b.interval=setTimeout(a,c.Delay)))};b.interval=setTimeout(a,0)},c.Stop=function(){b.isAlive=!1},c.Pause=function(){b.isPaused=!0},c.Continue=function(){b.isPaused=!1},c.Constructor(a)},GAEngine.Array={},GAEngine.Array.Clone=function(a){return a.slice(0)},GAEngine.Array.Clear=function(a){return a.splice(0)},GAEngine.Array.Shuffle=function(a){for(var b=GAEngine.Array.Clone(a),c=b.length-1;0<c;c--){var d=Math.floor(GAEngine.Random.Get()*(c+1)),e=b[c];b[c]=b[d],b[d]=e}return b};